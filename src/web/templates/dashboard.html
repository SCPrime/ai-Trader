<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trading Bot Dashboard</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ¤–</text></svg>">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

    <!-- Custom CSS -->
    <link href="/static/css/dashboard.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-robot"></i> AI Trading Bot
            </a>

            <!-- Trading Mode Toggle -->
            <div class="navbar-nav me-auto">
                <div class="nav-item">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="tradingModeToggle"
                               {% if is_live_trading %}checked{% endif %}>
                        <label class="form-check-label text-light" for="tradingModeToggle">
                            <span id="tradingModeLabel">
                                {% if is_live_trading %}Live Trading{% else %}Paper Trading{% endif %}
                            </span>
                        </label>
                    </div>
                </div>

                <div class="nav-item ms-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="aiModeToggle"
                               {% if is_ai_auto_mode %}checked{% endif %}>
                        <label class="form-check-label text-light" for="aiModeToggle">
                            <span id="aiModeLabel">
                                {% if is_ai_auto_mode %}AI Auto{% else %}Manual{% endif %}
                            </span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Morning Routine Button -->
            <div class="navbar-nav me-3">
                <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#morningRoutineModal">
                    <i class="fas fa-sun"></i> Morning Check
                </button>
            </div>

            <!-- AI Chat Button -->
            <div class="navbar-nav me-3">
                <button class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#aiChatModal">
                    <i class="fas fa-robot"></i> AI Chat
                </button>
            </div>

            <!-- News Research Button -->
            <div class="navbar-nav me-3">
                <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#newsResearchModal">
                    <i class="fas fa-newspaper"></i> News Research
                </button>
            </div>

            <!-- Connection Status -->
            <div class="navbar-nav">
                <div class="nav-item">
                    <span class="badge bg-success" id="connectionStatus">
                        <i class="fas fa-circle"></i> Connected
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-3">
        <!-- Dashboard Cards -->
        <div class="row mb-4">
            <!-- Portfolio Value -->
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">Portfolio Value</h6>
                                <h4 id="portfolioValue">Loading...</h4>
                                <small id="portfolioChange">--</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-chart-line fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Buying Power -->
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">Buying Power</h6>
                                <h4 id="buyingPower">Loading...</h4>
                                <small>Available Cash</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-dollar-sign fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Positions -->
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">Active Positions</h6>
                                <h4 id="activePositions">Loading...</h4>
                                <small>Open Trades</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-briefcase fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Health -->
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">System Health</h6>
                                <h4 id="systemHealth">Loading...</h4>
                                <small>All Systems</small>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-heartbeat fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Trading Interface -->
        <div class="row">
            <!-- Chart Panel -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-candlestick"></i> Price Chart
                            </h5>
                            <div class="input-group" style="width: 200px;">
                                <input type="text" class="form-control" id="symbolInput"
                                       placeholder="Symbol" value="AAPL">
                                <button class="btn btn-outline-primary" type="button" id="loadChart">
                                    Load
                                </button>
                            </div>
                            <div id="currentPrice" class="mt-2 small text-success">
                                <i class="fas fa-chart-line"></i> <span id="priceDisplay">Real-time data loading...</span>
                            </div>
                            <div id="dataSource" class="mt-1 small text-muted">
                                <i class="fas fa-database"></i> <span id="sourceDisplay">Yahoo Finance API</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="chartContainer" style="height: 600px;">
                            <div class="d-flex justify-content-center align-items-center h-100">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading chart...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="col-lg-4">
                <!-- AI Analysis Panel -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-brain"></i> AI Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="aiAnalysis">
                            <div class="text-center">
                                <button class="btn btn-primary" id="getAiAnalysis" disabled>
                                    <i class="fas fa-magic"></i> Get AI Analysis
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trading Panel -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-exchange-alt"></i> Quick Trade
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="tradeForm">
                            <div class="mb-3">
                                <label for="tradeSymbol" class="form-label">Symbol</label>
                                <input type="text" class="form-control" id="tradeSymbol" value="AAPL">
                            </div>
                            <div class="mb-3">
                                <label for="tradeQuantity" class="form-label">Quantity</label>
                                <input type="number" class="form-control" id="tradeQuantity" value="10">
                            </div>
                            <div class="mb-3">
                                <label for="tradeType" class="form-label">Order Type</label>
                                <select class="form-select" id="tradeType">
                                    <option value="market">Market</option>
                                    <option value="limit">Limit</option>
                                </select>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-success" id="buyButton" onclick="dashboard.placeTrade('buy')">
                                    <i class="fas fa-arrow-up"></i> Buy
                                </button>
                                <button type="button" class="btn btn-danger" id="sellButton" onclick="dashboard.placeTrade('sell')">
                                    <i class="fas fa-arrow-down"></i> Sell
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Technical Indicators -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line"></i> Technical Indicators
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="technicalIndicators">
                            <div class="text-muted text-center">
                                Load a chart to see indicators
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy and Settings Management -->
        <div class="row mt-4">
            <!-- Natural Language Strategy Interface -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-comments"></i> AI Strategy Creator
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="strategyForm">
                            <div class="mb-3">
                                <label for="strategyName" class="form-label">Strategy Name</label>
                                <input type="text" class="form-control" id="strategyName" placeholder="My Trading Strategy">
                            </div>
                            <div class="mb-3">
                                <label for="strategyDescription" class="form-label">Description</label>
                                <input type="text" class="form-control" id="strategyDescription" placeholder="Brief description">
                            </div>
                            <div class="mb-3">
                                <label for="strategyRules" class="form-label">Natural Language Rules</label>
                                <textarea class="form-control" id="strategyRules" rows="4"
                                    placeholder="Example: Buy AAPL when RSI drops below 30 and then crosses back above 35. Take profit at 3% gain. Stop loss at 2% loss. Use 2% position size."></textarea>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-primary" id="createStrategy">
                                    <i class="fas fa-plus"></i> Create Strategy
                                </button>
                                <button type="button" class="btn btn-outline-secondary" id="loadExamples">
                                    <i class="fas fa-lightbulb"></i> Load Examples
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Strategies Management -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-folder"></i> Saved Strategies
                        </h5>
                        <button class="btn btn-sm btn-outline-primary" id="refreshStrategies">
                            <i class="fas fa-sync"></i>
                        </button>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="strategiesList">
                            <div class="text-center text-muted">
                                <i class="fas fa-folder-open fa-2x mb-2"></i>
                                <p>No strategies saved yet</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Center -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-cog"></i> Trading Control Center
                            </h5>
                            <div>
                                <button class="btn btn-sm btn-outline-secondary me-2" id="loadPresets">
                                    <i class="fas fa-download"></i> Load Presets
                                </button>
                                <button class="btn btn-sm btn-warning" id="resetSettings">
                                    <i class="fas fa-undo"></i> Reset to Defaults
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Risk Management -->
                            <div class="col-md-4">
                                <h6 class="text-primary">Risk Management</h6>
                                <div class="mb-3">
                                    <label for="positionSize" class="form-label">Position Size (%)</label>
                                    <input type="number" class="form-control form-control-sm" id="positionSize"
                                           step="0.01" min="0" max="100" value="2">
                                </div>
                                <div class="mb-3">
                                    <label for="stopLoss" class="form-label">Stop Loss (%)</label>
                                    <input type="number" class="form-control form-control-sm" id="stopLoss"
                                           step="0.01" min="0" max="50" value="2">
                                </div>
                                <div class="mb-3">
                                    <label for="takeProfit" class="form-label">Take Profit (%)</label>
                                    <input type="number" class="form-control form-control-sm" id="takeProfit"
                                           step="0.01" min="0" max="100" value="4">
                                </div>
                                <div class="mb-3">
                                    <label for="maxDailyLoss" class="form-label">Max Daily Loss (%)</label>
                                    <input type="number" class="form-control form-control-sm" id="maxDailyLoss"
                                           step="0.01" min="0" max="100" value="5">
                                </div>
                            </div>

                            <!-- Trading Behavior -->
                            <div class="col-md-4">
                                <h6 class="text-success">Trading Behavior</h6>
                                <div class="mb-3">
                                    <label for="maxPositions" class="form-label">Max Positions</label>
                                    <input type="number" class="form-control form-control-sm" id="maxPositions"
                                           min="1" max="50" value="5">
                                </div>
                                <div class="mb-3">
                                    <label for="maxDailyTrades" class="form-label">Max Daily Trades</label>
                                    <input type="number" class="form-control form-control-sm" id="maxDailyTrades"
                                           min="1" max="100" value="20">
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="requireConfirmation" checked>
                                        <label class="form-check-label" for="requireConfirmation">
                                            Require Trade Confirmation
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="enableTrailingStops">
                                        <label class="form-check-label" for="enableTrailingStops">
                                            Enable Trailing Stops
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- AI & Technical Settings -->
                            <div class="col-md-4">
                                <h6 class="text-info">AI & Technical</h6>
                                <div class="mb-3">
                                    <label for="aiConfidenceThreshold" class="form-label">AI Confidence Threshold</label>
                                    <input type="number" class="form-control form-control-sm" id="aiConfidenceThreshold"
                                           step="0.01" min="0" max="1" value="0.7">
                                </div>
                                <div class="mb-3">
                                    <label for="rsiPeriod" class="form-label">RSI Period</label>
                                    <input type="number" class="form-control form-control-sm" id="rsiPeriod"
                                           min="1" max="50" value="14">
                                </div>
                                <div class="mb-3">
                                    <label for="smaShort" class="form-label">Short SMA Period</label>
                                    <input type="number" class="form-control form-control-sm" id="smaShort"
                                           min="1" max="200" value="20">
                                </div>
                                <div class="mb-3">
                                    <label for="smaLong" class="form-label">Long SMA Period</label>
                                    <input type="number" class="form-control form-control-sm" id="smaLong"
                                           min="1" max="200" value="50">
                                </div>
                            </div>
                        </div>

                        <!-- Settings Actions -->
                        <div class="row">
                            <div class="col-12">
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <button class="btn btn-success" id="saveSettings" onclick="dashboard.saveSettings()">
                                            <i class="fas fa-save"></i> Save Settings
                                        </button>
                                        <button class="btn btn-outline-primary ms-2" id="validateSettings">
                                            <i class="fas fa-check"></i> Validate
                                        </button>
                                    </div>
                                    <div id="settingsStatus" class="align-self-center">
                                        <small class="text-muted">Ready to configure</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Positions Dashboard -->
        <div class="row mt-4">
            <!-- Comprehensive Positions View -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-pie"></i> Portfolio Positions Snapshot
                        </h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" id="refreshPositions">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                            <span class="badge bg-info" id="lastUpdated">Last updated: --</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="positionsTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th class="text-center">Symbol</th>
                                        <th class="text-center">Type</th>
                                        <th class="text-center">Qty</th>
                                        <th class="text-center">Avg Price</th>
                                        <th class="text-center">Current Price</th>
                                        <th class="text-center">Market Value</th>
                                        <th class="text-center">Day P&L</th>
                                        <th class="text-center">Day P&L %</th>
                                        <th class="text-center">Total P&L</th>
                                        <th class="text-center">Total P&L %</th>
                                        <th class="text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="11" class="text-center text-muted py-4">
                                            <div class="spinner-border spinner-border-sm me-2" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            Loading positions...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- No Positions State -->
                        <div id="noPositionsMessage" class="text-center py-5" style="display: none;">
                            <div class="text-muted">
                                <i class="fas fa-chart-line fa-3x mb-3"></i>
                                <h5>No Open Positions</h5>
                                <p>Start trading to see your positions here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats and Orders -->
        <div class="row mt-4">
            <!-- Portfolio Summary -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-calculator"></i> Portfolio Summary
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-12 mb-3">
                                <div class="border rounded p-3 bg-light">
                                    <small class="text-muted">Total Portfolio Value</small>
                                    <h4 class="mb-0 text-primary" id="totalPortfolioValue">$10,000.00</h4>
                                    <small class="text-success" id="portfolioChange">+2.5% ($250.00)</small>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Day P&L</small>
                                    <h6 class="mb-0 text-success" id="totalDayPnL">+$125.50</h6>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Unrealized P&L</small>
                                    <h6 class="mb-0 text-warning" id="totalUnrealizedPnL">+$85.20</h6>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Options Premium</small>
                                    <h6 class="mb-0 text-info" id="optionsPremium">$245.75</h6>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Buying Power</small>
                                    <h6 class="mb-0 text-secondary" id="availableBuyingPower">$7,824.30</h6>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Active Positions</small>
                                    <h6 class="mb-0" id="activePositionsCount">8</h6>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Win Rate</small>
                                    <h6 class="mb-0 text-success" id="winRate">78.5%</h6>
                                </div>
                            </div>
                            <div class="col-12 mt-2">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Today's Strategy Performance</small>
                                    <div class="progress mt-1" style="height: 8px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 78%" id="todayPerformanceBar"></div>
                                    </div>
                                    <small class="text-success" id="todayPerformanceText">78% Success Rate (7/9 trades)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-history"></i> Recent Orders
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm" id="ordersTable">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Symbol</th>
                                        <th>Side</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">
                                            Loading orders...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy Management & Testing Section -->
        <div class="row mt-4">
            <!-- Strategy Selection & Actions -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chess"></i> Strategy Management
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Strategy Selection -->
                        <div class="mb-3">
                            <label for="strategySelect" class="form-label">Choose Strategy</label>
                            <select class="form-select" id="strategySelect">
                                <option value="">Loading strategies...</option>
                            </select>
                            <small class="text-muted">Includes your saved custom strategies</small>
                        </div>

                        <!-- Symbols Selection -->
                        <div class="mb-3">
                            <label for="strategySymbols" class="form-label">Test Symbols</label>
                            <input type="text" class="form-control" id="strategySymbols"
                                   placeholder="AAPL,MSFT,GOOGL,TSLA,AMZN"
                                   value="AAPL,MSFT,GOOGL,TSLA,AMZN">
                            <small class="text-muted">Comma-separated symbols</small>
                        </div>

                        <!-- Allocation -->
                        <div class="mb-3">
                            <label for="allocationAmount" class="form-label">Allocation ($)</label>
                            <input type="number" class="form-control" id="allocationAmount"
                                   value="1000" min="100" step="100">
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" id="strategizeBtn">
                                <i class="fas fa-search"></i> Strategize (Test Market)
                            </button>
                            <button class="btn btn-info" id="backtestBtn" data-bs-toggle="modal" data-bs-target="#backtestModal">
                                <i class="fas fa-chart-bar"></i> Run Backtest
                            </button>
                            <button class="btn btn-warning" onclick="dashboard.openOptionsCenter()">
                                <i class="fas fa-chart-pie"></i> Options Center
                            </button>
                            <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#portfolioAnalyticsModal">
                                <i class="fas fa-chart-area"></i> Portfolio Analytics
                            </button>
                            <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#tradeJournalModal">
                                <i class="fas fa-book"></i> Trade Journal
                            </button>
                            <button class="btn btn-success" id="implementStrategyBtn" disabled>
                                <i class="fas fa-play"></i> Implement Strategy
                            </button>
                            <button class="btn btn-info" id="viewActiveStrategies">
                                <i class="fas fa-eye"></i> View Active Strategies
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Strategy Results Table -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar"></i> Strategy Universe
                        </h5>
                        <div>
                            <span class="badge bg-secondary" id="strategyStatus">Ready</span>
                            <span class="badge bg-info" id="lastStrategyUpdate">--</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Strategy Results Loading State -->
                        <div id="strategyResultsLoading" class="text-center py-4" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Testing strategy...</span>
                            </div>
                            <div class="mt-2"><strong>Running strategy analysis...</strong></div>
                            <div class="small text-muted">Testing against live market data</div>
                        </div>

                        <!-- Strategy Results Table -->
                        <div class="table-responsive" id="strategyResultsContainer">
                            <table class="table table-hover" id="strategyResultsTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th class="text-center">Symbol</th>
                                        <th class="text-center">Current Price</th>
                                        <th class="text-center">Signal</th>
                                        <th class="text-center">Confidence</th>
                                        <th class="text-center">Action</th>
                                        <th class="text-center">Est. Profit</th>
                                        <th class="text-center">Total Cost</th>
                                        <th class="text-center">ROI</th>
                                        <th class="text-center">Reasoning</th>
                                        <th class="text-center">Investment Details</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="10" class="text-center text-muted py-4">
                                            Select a strategy and click "Strategize" to test against live market data
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- Selection Totals -->
                            <div id="selectionTotals" class="mt-3 p-3 bg-light border rounded">
                                <div class="row text-center">
                                    <div class="col-md-3">
                                        <div class="border rounded p-2">
                                            <h6 class="mb-1">Selected</h6>
                                            <strong class="text-primary">0 positions</strong>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border rounded p-2">
                                            <h6 class="mb-1">Total Cost</h6>
                                            <strong class="text-danger">$0</strong>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border rounded p-2">
                                            <h6 class="mb-1">Est. Profit</h6>
                                            <strong class="text-success">$0.00</strong>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border rounded p-2">
                                            <h6 class="mb-1">Avg ROI</h6>
                                            <strong class="text-success">0.0%</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Strategy Performance Summary -->
                        <div id="strategyPerformanceSummary" class="mt-3" style="display: none;">
                            <div class="row text-center">
                                <div class="col-3">
                                    <div class="border rounded p-2">
                                        <small class="text-muted">Buy Signals</small>
                                        <h6 class="mb-0 text-success" id="buySignalsCount">0</h6>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="border rounded p-2">
                                        <small class="text-muted">Sell Signals</small>
                                        <h6 class="mb-0 text-danger" id="sellSignalsCount">0</h6>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="border rounded p-2">
                                        <small class="text-muted">Hold Signals</small>
                                        <h6 class="mb-0 text-warning" id="holdSignalsCount">0</h6>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="border rounded p-2">
                                        <small class="text-muted">Avg Confidence</small>
                                        <h6 class="mb-0 text-info" id="avgConfidence">0%</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Strategies Monitoring -->
        <div class="row mt-4" id="activeStrategiesSection" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-cogs"></i> Active Trading Strategies
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped" id="activeStrategiesTable">
                                <thead>
                                    <tr>
                                        <th>Strategy</th>
                                        <th>Status</th>
                                        <th>Symbols</th>
                                        <th>Allocation</th>
                                        <th>Total Trades</th>
                                        <th>P&L</th>
                                        <th>Win Rate</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="8" class="text-center text-muted">
                                            No active strategies
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div class="modal fade" id="aiChatModal" tabindex="-1" aria-labelledby="aiChatModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="aiChatModalLabel">
                        <i class="fas fa-robot text-info"></i> AI Trading Assistant
                        <span class="badge bg-info ms-2" id="aiProvider">Claude</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0" style="height: 70vh;">
                    <div class="row g-0 h-100">
                        <!-- Sidebar with Quick Actions -->
                        <div class="col-md-3 bg-secondary p-3">
                            <h6><i class="fas fa-bolt"></i> Quick Actions</h6>
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-light btn-sm" onclick="sendAIMessage('What are my current positions?')">
                                    <i class="fas fa-chart-pie"></i> Portfolio Overview
                                </button>
                                <button class="btn btn-outline-light btn-sm" onclick="sendAIMessage('How is my performance today?')">
                                    <i class="fas fa-chart-line"></i> Today\'s Performance
                                </button>
                                <button class="btn btn-outline-light btn-sm" onclick="sendAIMessage('Analyze AAPL stock')">
                                    <i class="fas fa-search"></i> Stock Analysis
                                </button>
                                <button class="btn btn-outline-light btn-sm" onclick="sendAIMessage('What is my risk exposure?')">
                                    <i class="fas fa-exclamation-triangle"></i> Risk Assessment
                                </button>
                                <button class="btn btn-outline-light btn-sm" onclick="sendAIMessage('Should I adjust my trading strategy?')">
                                    <i class="fas fa-cogs"></i> Strategy Review
                                </button>
                                <button class="btn btn-outline-light btn-sm" onclick="sendAIMessage('Show me market news and sentiment')">
                                    <i class="fas fa-newspaper"></i> Market News
                                </button>
                                <button class="btn btn-outline-light btn-sm" onclick="sendAIMessage('Explain options trading strategies')">
                                    <i class="fas fa-graduation-cap"></i> Options Education
                                </button>
                            </div>

                            <hr class="border-light">

                            <h6><i class="fas fa-info-circle"></i> Bot Status</h6>
                            <div class="small">
                                <div class="d-flex justify-content-between">
                                    <span>Mode:</span>
                                    <span class="badge bg-success">Paper Trading</span>
                                </div>
                                <div class="d-flex justify-content-between mt-1">
                                    <span>Portfolio:</span>
                                    <span id="aiChatPortfolioValue">Loading...</span>
                                </div>
                                <div class="d-flex justify-content-between mt-1">
                                    <span>P&L Today:</span>
                                    <span id="aiChatDayPnL" class="text-success">Loading...</span>
                                </div>
                                <div class="d-flex justify-content-between mt-1">
                                    <span>Positions:</span>
                                    <span id="aiChatPositionCount">Loading...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Area -->
                        <div class="col-md-9 d-flex flex-column">
                            <!-- Messages -->
                            <div class="flex-grow-1 p-3 overflow-auto" id="aiChatMessages" style="max-height: calc(70vh - 80px);">
                                <div class="ai-message mb-3">
                                    <div class="d-flex">
                                        <div class="me-2">
                                            <i class="fas fa-robot text-info"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="bg-info bg-opacity-10 p-2 rounded">
                                                Hello! I'm your AI trading assistant powered by Claude. I can help you:
                                                <ul class="mb-0 mt-2">
                                                    <li>Analyze your portfolio and positions</li>
                                                    <li>Explain market trends and news</li>
                                                    <li>Review trading strategies and risk</li>
                                                    <li>Provide educational content about trading</li>
                                                    <li>Answer questions about your trading bot</li>
                                                </ul>
                                                <div class="mt-2 small text-muted">
                                                    What would you like to know about your trading activity?
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Input Area -->
                            <div class="border-top border-secondary p-3">
                                <div class="input-group">
                                    <input type="text" class="form-control bg-dark text-light border-secondary"
                                           id="aiChatInput"
                                           placeholder="Ask about your trades, strategies, market analysis..."
                                           style="border-right: none;">
                                    <button class="btn btn-info" type="button" id="aiSendBtn">
                                        <i class="fas fa-paper-plane"></i> Send
                                    </button>
                                </div>
                                <div class="small text-muted mt-1">
                                    <i class="fas fa-lightbulb"></i>
                                    Tip: Try asking "What's my best performing stock?" or "Explain covered calls"
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Backtest Modal -->
    <div class="modal fade" id="backtestModal" tabindex="-1" aria-labelledby="backtestModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="backtestModalLabel">
                        <i class="fas fa-chart-bar text-info"></i> Strategy Backtesting
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Backtest Configuration -->
                        <div class="col-md-4">
                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-cogs"></i> Backtest Configuration</h6>
                                </div>
                                <div class="card-body">
                                    <form id="backtestForm">
                                        <div class="mb-3">
                                            <label for="backtestSymbol" class="form-label">Symbol</label>
                                            <input type="text" class="form-control bg-dark text-light border-secondary"
                                                   id="backtestSymbol" value="AAPL" placeholder="e.g., AAPL, MSFT">
                                        </div>

                                        <div class="mb-3">
                                            <label for="backtestStrategy" class="form-label">Strategy</label>
                                            <select class="form-select bg-dark text-light border-secondary" id="backtestStrategy">
                                                <option value="buy_hold">Buy & Hold</option>
                                                <option value="sma_crossover">SMA Crossover</option>
                                                <option value="rsi_strategy">RSI Strategy</option>
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label for="backtestPeriod" class="form-label">Time Period</label>
                                            <select class="form-select bg-dark text-light border-secondary" id="backtestPeriod">
                                                <option value="3mo">3 Months</option>
                                                <option value="6mo">6 Months</option>
                                                <option value="1y" selected>1 Year</option>
                                                <option value="2y">2 Years</option>
                                                <option value="5y">5 Years</option>
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label for="backtestCapital" class="form-label">Initial Capital</label>
                                            <input type="number" class="form-control bg-dark text-light border-secondary"
                                                   id="backtestCapital" value="10000" min="1000" step="1000">
                                        </div>

                                        <!-- Strategy Parameters (Dynamic) -->
                                        <div id="strategyParameters" class="mb-3">
                                            <!-- Parameters will be populated based on selected strategy -->
                                        </div>

                                        <button type="button" class="btn btn-primary w-100" id="runBacktestBtn" onclick="dashboard.runComprehensiveBacktest()">
                                            <i class="fas fa-play"></i> Run Backtest
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Backtest Results -->
                        <div class="col-md-8">
                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-chart-line"></i> Backtest Results</h6>
                                </div>
                                <div class="card-body">
                                    <!-- Loading State -->
                                    <div id="backtestLoading" style="display: none;">
                                        <div class="text-center py-5">
                                            <div class="spinner-border text-primary" role="status"></div>
                                            <div class="mt-2">Running backtest...</div>
                                        </div>
                                    </div>

                                    <!-- Results Display -->
                                    <div id="backtestResults" style="display: none;">
                                        <!-- Performance Metrics -->
                                        <div class="row mb-4">
                                            <div class="col-md-3">
                                                <div class="text-center p-2 border rounded">
                                                    <div class="h5 mb-1" id="totalReturn">-</div>
                                                    <div class="small text-muted">Total Return</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="text-center p-2 border rounded">
                                                    <div class="h5 mb-1" id="winRate">-</div>
                                                    <div class="small text-muted">Win Rate</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="text-center p-2 border rounded">
                                                    <div class="h5 mb-1" id="sharpeRatio">-</div>
                                                    <div class="small text-muted">Sharpe Ratio</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="text-center p-2 border rounded">
                                                    <div class="h5 mb-1" id="maxDrawdown">-</div>
                                                    <div class="small text-muted">Max Drawdown</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Equity Curve Chart -->
                                        <div class="mb-4">
                                            <div id="equityCurveChart" style="height: 400px;"></div>
                                        </div>

                                        <!-- Trade Details -->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6>Trade Summary</h6>
                                                <table class="table table-dark table-sm">
                                                    <tr><td>Total Trades:</td><td id="totalTrades">-</td></tr>
                                                    <tr><td>Average Trade:</td><td id="avgTrade">-</td></tr>
                                                    <tr><td>Best Trade:</td><td id="bestTrade">-</td></tr>
                                                    <tr><td>Worst Trade:</td><td id="worstTrade">-</td></tr>
                                                    <tr><td>Final Value:</td><td id="finalValue">-</td></tr>
                                                </table>
                                            </div>
                                            <div class="col-md-6">
                                                <h6>Recent Trades</h6>
                                                <div id="tradesList" style="max-height: 200px; overflow-y: auto;">
                                                    <!-- Trade list will be populated here -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Error Display -->
                                    <div id="backtestError" style="display: none;">
                                        <div class="alert alert-danger">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            <span id="errorMessage">An error occurred during backtesting.</span>
                                        </div>
                                    </div>

                                    <!-- Initial Message -->
                                    <div id="backtestInitial">
                                        <div class="text-center py-5 text-muted">
                                            <i class="fas fa-chart-bar fa-3x mb-3"></i>
                                            <h5>Strategy Backtesting</h5>
                                            <p>Configure your backtest parameters and click "Run Backtest" to see how your strategy would have performed historically.</p>
                                            <div class="mt-3">
                                                <small>
                                                    <strong>Available Strategies:</strong><br>
                                                    â€¢ <strong>Buy & Hold:</strong> Simple buy and hold for baseline comparison<br>
                                                    â€¢ <strong>SMA Crossover:</strong> Moving average crossover signals<br>
                                                    â€¢ <strong>RSI Strategy:</strong> Oversold/overbought RSI signals
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Morning Routine Modal -->
    <div class="modal fade" id="morningRoutineModal" tabindex="-1" aria-labelledby="morningRoutineModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="morningRoutineModalLabel">
                        <i class="fas fa-sun text-warning"></i> Morning Market Check
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card bg-secondary mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-clock"></i> Market Status</h6>
                                </div>
                                <div class="card-body">
                                    <div id="marketStatus">
                                        <div class="d-flex justify-content-between">
                                            <span>Status:</span>
                                            <span id="marketOpen" class="badge bg-success">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between mt-2">
                                            <span>Next Open:</span>
                                            <span id="nextOpen">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between mt-2">
                                            <span>Time:</span>
                                            <span id="currentTime">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-wallet"></i> Account Summary</h6>
                                </div>
                                <div class="card-body">
                                    <div id="accountSummary">
                                        <div class="d-flex justify-content-between">
                                            <span>Portfolio Value:</span>
                                            <span id="morningPortfolioValue">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between mt-2">
                                            <span>Buying Power:</span>
                                            <span id="morningBuyingPower">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between mt-2">
                                            <span>Day Change:</span>
                                            <span id="morningDayChange" class="text-success">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="card bg-secondary mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-chart-line"></i> Your Positions</h6>
                                </div>
                                <div class="card-body">
                                    <div id="morningPositions" style="max-height: 200px; overflow-y: auto;">
                                        Loading positions...
                                    </div>
                                </div>
                            </div>

                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-list"></i> Pending Orders</h6>
                                </div>
                                <div class="card-body">
                                    <div id="morningOrders" style="max-height: 150px; overflow-y: auto;">
                                        Loading orders...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-newspaper"></i> Market News Headlines</h6>
                                </div>
                                <div class="card-body">
                                    <div id="morningNews" style="max-height: 200px; overflow-y: auto;">
                                        Loading market news...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div id="morningRoutineLoading" class="text-center py-4" style="display: none;">
                        <div class="spinner-border text-warning" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <div class="mt-2">Running morning routine...</div>
                    </div>

                    <!-- Results Container -->
                    <div id="morningRoutineResults">
                        <div class="mt-3 text-center">
                            <button id="runMorningRoutineBtn" class="btn btn-warning">
                                <i class="fas fa-play"></i> Run Morning Routine
                            </button>
                            <button class="btn btn-success" onclick="scheduleMorningRoutine()">
                                <i class="fas fa-clock"></i> Schedule Daily
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- News Research Modal -->
    <div class="modal fade" id="newsResearchModal" tabindex="-1" aria-labelledby="newsResearchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="newsResearchModalLabel">
                        <i class="fas fa-newspaper text-success"></i> News Research Center
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control bg-dark text-light border-secondary"
                                   id="newsSymbolSearch" placeholder="Enter symbol (e.g., AAPL, MSFT)">
                        </div>
                        <div class="col-md-3">
                            <select class="form-select bg-dark text-light border-secondary" id="newsSource">
                                <option value="all">All Sources</option>
                                <option value="yahoo">Yahoo Finance</option>
                                <option value="google">Google News</option>
                                <option value="reddit">Reddit</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button id="searchNewsBtn" class="btn btn-success w-100">
                                <i class="fas fa-search"></i> Search News
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-list"></i> News Articles</h6>
                                </div>
                                <div class="card-body">
                                    <div id="newsResults" style="max-height: 500px; overflow-y: auto;">
                                        <div class="text-center text-muted py-5">
                                            <i class="fas fa-newspaper fa-3x mb-3"></i>
                                            <h5>News Research Center</h5>
                                            <p>Enter a symbol and click "Search News" to get the latest financial news and analysis.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card bg-secondary mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-chart-line"></i> Sentiment Analysis</h6>
                                </div>
                                <div class="card-body">
                                    <div id="sentimentAnalysis">
                                        <div class="text-center text-muted">
                                            Search for news to see sentiment analysis
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-calendar"></i> Upcoming Events</h6>
                                </div>
                                <div class="card-body">
                                    <div id="upcomingEvents">
                                        <div class="small">
                                            <div>â€¢ Earnings reports</div>
                                            <div>â€¢ Fed announcements</div>
                                            <div>â€¢ Economic data releases</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Options Center Modal -->
    <div class="modal fade" id="optionsModal" tabindex="-1" aria-labelledby="optionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="optionsModalLabel">
                        <i class="fas fa-chart-pie text-warning"></i> Options Trading Center - <span id="optionsSymbol">AAPL</span> @ $<span id="optionsPrice">0.00</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Options Header Info -->
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <div class="card bg-secondary">
                                <div class="card-body py-2">
                                    <div class="row text-center">
                                        <div class="col-md-2">
                                            <small class="text-muted">Expiration</small><br>
                                            <span id="optionsExpiration" class="fw-bold">2025-10-18</span>
                                        </div>
                                        <div class="col-md-2">
                                            <small class="text-muted">IV Rank</small><br>
                                            <span id="ivRank" class="fw-bold">50%</span>
                                        </div>
                                        <div class="col-md-2">
                                            <small class="text-muted">Call Volume</small><br>
                                            <span id="totalCallVolume" class="fw-bold text-success">0</span>
                                        </div>
                                        <div class="col-md-2">
                                            <small class="text-muted">Put Volume</small><br>
                                            <span id="totalPutVolume" class="fw-bold text-danger">0</span>
                                        </div>
                                        <div class="col-md-2">
                                            <small class="text-muted">P/C Ratio</small><br>
                                            <span id="putCallRatio" class="fw-bold">0.00</span>
                                        </div>
                                        <div class="col-md-2">
                                            <small class="text-muted">Max Pain</small><br>
                                            <span id="maxPain" class="fw-bold">$250</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs Navigation -->
                    <ul class="nav nav-tabs nav-fill mb-3" id="optionsTabs">
                        <li class="nav-item">
                            <a class="nav-link active bg-dark text-light" data-bs-toggle="tab" href="#optionsChainTab">
                                <i class="fas fa-table"></i> Options Chain
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link bg-dark text-light" data-bs-toggle="tab" href="#strategyBuilderTab">
                                <i class="fas fa-cogs"></i> Strategy Builder
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link bg-dark text-light" data-bs-toggle="tab" href="#greeksCalculatorTab">
                                <i class="fas fa-calculator"></i> Greeks Calculator
                            </a>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content" id="optionsTabContent">
                        <!-- Options Chain Tab -->
                        <div class="tab-pane fade show active" id="optionsChainTab">
                            <div class="table-responsive" style="max-height: 500px;">
                                <table class="table table-dark table-hover table-sm">
                                    <thead class="table-secondary sticky-top">
                                        <tr>
                                            <th colspan="3" class="text-center text-success">CALLS</th>
                                            <th class="text-center">STRIKE</th>
                                            <th colspan="3" class="text-center text-danger">PUTS</th>
                                            <th class="text-center">ACTION</th>
                                        </tr>
                                        <tr class="small">
                                            <th class="text-end">IV/Vol</th>
                                            <th class="text-end">Greeks</th>
                                            <th class="text-end">Bid x Ask</th>
                                            <th class="text-center">Price</th>
                                            <th class="text-start">Bid x Ask</th>
                                            <th class="text-start">Greeks</th>
                                            <th class="text-start">IV/Vol</th>
                                            <th class="text-center">Trade</th>
                                        </tr>
                                    </thead>
                                    <tbody id="optionsChainBody">
                                        <tr>
                                            <td colspan="8" class="text-center py-4">
                                                <div class="spinner-border text-primary" role="status"></div>
                                                <div class="mt-2">Loading options chain...</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Strategy Builder Tab -->
                        <div class="tab-pane fade" id="strategyBuilderTab">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card bg-secondary mb-3">
                                        <div class="card-header">
                                            <h6 class="mb-0"><i class="fas fa-magic"></i> Quick Strategies</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-primary btn-sm" onclick="dashboard.createQuickStrategy('bull_call_spread')">
                                                    Bull Call Spread
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="dashboard.createQuickStrategy('bear_put_spread')">
                                                    Bear Put Spread
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="dashboard.createQuickStrategy('iron_condor')">
                                                    Iron Condor
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="dashboard.createQuickStrategy('strangle')">
                                                    Long Strangle
                                                </button>
                                                <button class="btn btn-outline-danger btn-sm" onclick="dashboard.clearStrategy()">
                                                    Clear Strategy
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card bg-secondary">
                                        <div class="card-header">
                                            <h6 class="mb-0"><i class="fas fa-list"></i> Strategy Legs</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="strategyLegs">
                                                <p class="text-muted">Add options from the chain or use quick strategies</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-8">
                                    <div class="card bg-secondary">
                                        <div class="card-header">
                                            <h6 class="mb-0"><i class="fas fa-chart-area"></i> Strategy Analysis</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="strategyAnalysis">
                                                <p class="text-muted">Add options to build a strategy</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Greeks Calculator Tab -->
                        <div class="tab-pane fade" id="greeksCalculatorTab">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card bg-secondary">
                                        <div class="card-header">
                                            <h6 class="mb-0"><i class="fas fa-calculator"></i> Calculate Greeks</h6>
                                        </div>
                                        <div class="card-body">
                                            <form id="greeksForm">
                                                <div class="mb-3">
                                                    <label class="form-label">Strike Price</label>
                                                    <input type="number" class="form-control bg-dark text-light border-secondary"
                                                           id="greeksStrikeInput" value="250" step="5">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Option Type</label>
                                                    <select class="form-select bg-dark text-light border-secondary" id="greeksTypeInput">
                                                        <option value="call">Call</option>
                                                        <option value="put">Put</option>
                                                    </select>
                                                </div>
                                                <button type="button" class="btn btn-primary" onclick="dashboard.showGreeksCalculator(document.getElementById('greeksStrikeInput').value, document.getElementById('greeksTypeInput').value)">
                                                    Calculate Greeks
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card bg-secondary">
                                        <div class="card-header">
                                            <h6 class="mb-0"><i class="fas fa-info-circle"></i> Greeks Information</h6>
                                        </div>
                                        <div class="card-body">
                                            <p><strong>Delta:</strong> Price sensitivity to underlying movement</p>
                                            <p><strong>Gamma:</strong> Rate of change of delta</p>
                                            <p><strong>Theta:</strong> Time decay per day</p>
                                            <p><strong>Vega:</strong> Sensitivity to volatility changes</p>
                                            <p><strong>Rho:</strong> Sensitivity to interest rate changes</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Greeks Calculator Modal -->
    <div class="modal fade" id="greeksModal" tabindex="-1" aria-labelledby="greeksModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="greeksModalLabel">
                        <i class="fas fa-calculator text-info"></i> Greeks Calculator -
                        <span id="greeksSymbol">AAPL</span> $<span id="greeksStrike">250</span> <span id="greeksType">CALL</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0">Option Details</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm table-dark mb-0">
                                        <tr><td>Option Price:</td><td id="greeksPrice" class="fw-bold">$0.00</td></tr>
                                        <tr><td>Underlying Price:</td><td id="greeksUnderlying" class="fw-bold">$0.00</td></tr>
                                        <tr><td>Intrinsic Value:</td><td class="fw-bold">$0.00</td></tr>
                                        <tr><td>Time Value:</td><td class="fw-bold">$0.00</td></tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0">The Greeks</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm table-dark mb-0">
                                        <tr><td>Delta:</td><td id="deltaValue" class="fw-bold text-success">0.0000</td></tr>
                                        <tr><td>Gamma:</td><td id="gammaValue" class="fw-bold text-info">0.0000</td></tr>
                                        <tr><td>Theta:</td><td id="thetaValue" class="fw-bold text-warning">0.0000</td></tr>
                                        <tr><td>Vega:</td><td id="vegaValue" class="fw-bold text-primary">0.0000</td></tr>
                                        <tr><td>Rho:</td><td id="rhoValue" class="fw-bold text-secondary">0.0000</td></tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-secondary">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-info-circle"></i> Greeks Explanations</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="small"><strong>Delta:</strong> <span id="deltaExplanation">Loading...</span></p>
                                    <p class="small"><strong>Gamma:</strong> <span id="gammaExplanation">Loading...</span></p>
                                    <p class="small"><strong>Theta:</strong> <span id="thetaExplanation">Loading...</span></p>
                                </div>
                                <div class="col-md-6">
                                    <p class="small"><strong>Vega:</strong> <span id="vegaExplanation">Loading...</span></p>
                                    <p class="small"><strong>Rho:</strong> <span id="rhoExplanation">Loading...</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Portfolio Analytics Modal -->
    <div class="modal fade" id="portfolioAnalyticsModal" tabindex="-1" aria-labelledby="portfolioAnalyticsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="portfolioAnalyticsModalLabel">
                        <i class="fas fa-chart-area text-primary"></i> Portfolio Analytics
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Portfolio Overview -->
                        <div class="col-md-6">
                            <div class="card bg-secondary mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-wallet"></i> Portfolio Overview</h6>
                                </div>
                                <div class="card-body">
                                    <div id="portfolioOverview">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Total Value:</span>
                                            <span id="portfolioTotalValue" class="fw-bold">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Day Change:</span>
                                            <span id="portfolioDayChange" class="fw-bold">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Total Return:</span>
                                            <span id="portfolioTotalReturn" class="fw-bold">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>Cash Available:</span>
                                            <span id="portfolioCash" class="fw-bold">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-shield-alt"></i> Risk Metrics</h6>
                                </div>
                                <div class="card-body">
                                    <div id="riskMetrics">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Beta:</span>
                                            <span id="portfolioBeta">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Sharpe Ratio:</span>
                                            <span id="portfolioSharpe">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Volatility:</span>
                                            <span id="portfolioVolatility">Loading...</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>VaR (95%):</span>
                                            <span id="portfolioVaR" class="text-danger">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Holdings & Performance Chart -->
                        <div class="col-md-6">
                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-chart-pie"></i> Portfolio Composition</h6>
                                </div>
                                <div class="card-body">
                                    <div id="portfolioChart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-list"></i> Current Holdings</h6>
                                </div>
                                <div class="card-body">
                                    <div id="portfolioHoldings" style="max-height: 300px; overflow-y: auto;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-primary" onclick="dashboard.loadPortfolioAnalytics()">
                        <i class="fas fa-sync-alt"></i> Refresh Analytics
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Trade Journal Modal -->
    <div class="modal fade" id="tradeJournalModal" tabindex="-1" aria-labelledby="tradeJournalModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="tradeJournalModalLabel">
                        <i class="fas fa-book text-warning"></i> Trade Journal
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <!-- Trade Journal Summary -->
                        <div class="col-md-12">
                            <div class="card bg-secondary mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-chart-bar"></i> Trading Performance Summary</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="text-center">
                                                <div class="h4 mb-1" id="totalTrades">-</div>
                                                <div class="small text-muted">Total Trades</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-center">
                                                <div class="h4 mb-1" id="profitableTrades">-</div>
                                                <div class="small text-muted">Profitable</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-center">
                                                <div class="h4 mb-1" id="journalWinRate">-</div>
                                                <div class="small text-muted">Win Rate</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-center">
                                                <div class="h4 mb-1" id="totalPnL">-</div>
                                                <div class="small text-muted">Total P&L</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Trade History Table -->
                        <div class="col-12">
                            <div class="card bg-secondary">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><i class="fas fa-history"></i> Trade History</h6>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary me-2" onclick="dashboard.loadTradeJournal()">
                                            <i class="fas fa-sync-alt"></i> Refresh
                                        </button>
                                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addTradeModal">
                                            <i class="fas fa-plus"></i> Add Trade
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="tradeJournalTable" style="max-height: 400px; overflow-y: auto;">
                                        <div class="text-center py-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <div class="mt-2">Loading trade journal...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Trade Modal -->
    <div class="modal fade" id="addTradeModal" tabindex="-1" aria-labelledby="addTradeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="addTradeModalLabel">
                        <i class="fas fa-plus"></i> Add Trade
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addTradeForm">
                        <div class="mb-3">
                            <label for="tradeSymbol" class="form-label">Symbol</label>
                            <input type="text" class="form-control bg-dark text-light border-secondary" id="tradeSymbol" required>
                        </div>
                        <div class="mb-3">
                            <label for="tradeStrategy" class="form-label">Strategy</label>
                            <select class="form-select bg-dark text-light border-secondary" id="tradeStrategy" required>
                                <option value="">Select Strategy</option>
                                <option value="buy_and_hold">Buy & Hold</option>
                                <option value="swing_trade">Swing Trade</option>
                                <option value="day_trade">Day Trade</option>
                                <option value="options">Options</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="tradeEntryDate" class="form-label">Entry Date</label>
                                    <input type="date" class="form-control bg-dark text-light border-secondary" id="tradeEntryDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="tradeExitDate" class="form-label">Exit Date (Optional)</label>
                                    <input type="date" class="form-control bg-dark text-light border-secondary" id="tradeExitDate">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="tradeEntryPrice" class="form-label">Entry Price</label>
                                    <input type="number" class="form-control bg-dark text-light border-secondary" id="tradeEntryPrice" step="0.01" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="tradeExitPrice" class="form-label">Exit Price (Optional)</label>
                                    <input type="number" class="form-control bg-dark text-light border-secondary" id="tradeExitPrice" step="0.01">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="tradeQuantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control bg-dark text-light border-secondary" id="tradeQuantity" required>
                        </div>
                        <div class="mb-3">
                            <label for="tradeNotes" class="form-label">Notes</label>
                            <textarea class="form-control bg-dark text-light border-secondary" id="tradeNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-success" onclick="dashboard.addTrade()">
                        <i class="fas fa-save"></i> Save Trade
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer">
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script src="/static/js/dashboard.js"></script>

    <!-- Global Function Wrappers -->
    <script>
        // Make sendAIMessage function globally accessible for onclick handlers
        window.sendAIMessage = function(message = null) {
            if (typeof sendAIMessage !== 'undefined') {
                return sendAIMessage(message);
            } else if (window.dashboard) {
                // Fallback: try calling through dashboard instance
                const input = document.getElementById('aiChatInput');
                const messageText = message || (input ? input.value.trim() : '');

                if (messageText) {
                    // Show AI Chat modal
                    const aiModal = document.getElementById('aiChatModal');
                    if (aiModal) {
                        const modal = new bootstrap.Modal(aiModal);
                        modal.show();
                    }

                    // Mock AI response for now
                    console.log('AI Message sent:', messageText);

                    if (input && !message) {
                        input.value = '';
                    }
                }
            }
        };
    </script>
</body>
</html>